# 6. Устройство и работа составных частей ПК

Конструктивно ПК состоит из следующих функционально законченных узлов и
блоков:

* модуль процессора 6.120.107;
* модуль ОЗУ 6.120.108;
* модуль локальной сети и таймер 6.120.109;
* модуль электронный 2MБ5 2.087.024;
* модуль электронный 2МБ12 2.087.024-01;
* блок клавиатуры 3.059.007;
* видеоконтрольное устройство (ВКУ).

## 6.1. Модуль процессора

Функционально модель процессора 6.120.107 ЭЗ состоит из следующих узлов:

* процессорное ядро;
* системное ПЗУ;
* контроллер клавиатуры;
* аппаратный умножитель;
* HALT-монитор.

Процессорное ядро включает в себя центральный процессорный элемент D1
(ЦПЭ КР588ВС2), выполняющий функции арифметико-логического устройства (АЛУ),
пять БИС управляющей памяти D2...D6 (КР588ВУ2), системный контроллер D18
(КР588ВГ1), два магистральных приемопередатчика (МПП) D21, D24 (КР588ВА1).

АЛУ предназначено для приема, хранения и обработки 16-разрядных чисел.
Преобразование данных выполняется в соответствии с 12-разрядным кодом
микрокоманды.

Последовательность фаз работы микросхемы определяет внутренний блок
синхронизации, функционирование которого начинается с поступлением
отрицательного фронта по входу сигнала сопровождения микрокоманды ВК (вывод
30).

Выполнение любой микрокоманды состоит из комбинации следующих фаз:

* приема: приема и дешифрации микрокоманды, а в некоторых микрокомандах и
  приема операнда по магистрали данных;
* чтения: чтения информации из источника (РОН, АКК, СК, К) в АЛУ и ее
  обработки;
* записи: окончание обработки информации и ее запись в приемник (РОН, АКК,
  СК, К;
* выдачи: выдача результата операции в МД.

Прием микрокоманд и обмен данными по магистрали производится асинхронно и
квитируется сигналами по выводам <kbd>ВК</kbd> и <kbd>Ф1</kbd>, <kbd>В</kbd>
и <kbd>П</kbd>, соответственно. Так как по шине микрокоманд информация может
только приниматься в АЛУ, выводы <kbd>ВК</kbd> и <kbd>Ф1</kbd> —
однонаправленные. Сигналы <kbd>В</kbd> и <kbd>П</kbd> — двунаправленные, т.к.
квитируют передачу данных по МД.

При приеме данных в МД сигнал на входе <kbd>В</kbd> генерируется системным
контроллером D18 и инициирует начало фазы ввода данных, сигнал на выходе
<kbd>П</kbd> служит квитанцией о приеме информации в АЛУ. При выдаче данных в
МД сигнал на выходе <kbd>В</kbd> (генерируется ЦПЭ) инициирует начало фазы
вывода данных, сигнал на входе <kbd>П</kbd> служит квитанцией для ЦПЭ о
приеме информации во внешние схемы. Ограничений на время ответа не
существует.

Управляющая память (УП) представляет собой программируемую логическую матрицу
(ПЛМ) с памятью. Она предназначена для управления работой процессорного ядра
и сочетает в себе функции БИС блока микропрограммного управления и ПЗУ
микрокоманд. Микросхемы с номерами кодировок 0001, 0002, 0004 предназначены
для управления АЛУ, БИС УП с кодировкой 0007 — для управления системным
контроллером D18, БИС с кодировкой 0006 предназначена для аппаратной
реализации команд расширенной арифметики (умножение, деление, сдвиги — MUL,
DIV, ASH, ASHC).

Сигналы на входах <kbd>R0</kbd> и <kbd>R1</kbd> по положительному фронту
устанавливают микросхему УП в исходное состояние. При наличии логического
нуля на выводе <kbd>В</kbd> происходит прием информации с магистрали данных
во входной регистр и по магистрали признаков кодов условий ветвления в
регистр признаков. Приняв информацию, микросхема устанавливает уровень
логического нуля на выводе <kbd>П</kbd> и активный низкий уровень на выводе
<kbd>КК</kbd>. При снятии сигнала «логический ноль» на выводе <kbd>В</kbd>
снимается сигнал и на выводе <kbd>П</kbd>.

По отрицательному фронту сигнала <kbd>Ф1</kbd> прекращается выдача
микрокоманды и происходит «подброс» в высокий потенциал состояния выводов
<kbd>МК(0-12)</kbd>. Если к этому времени сформирована следующая
микрокоманда, то происходит ее запись в регистры с последующей выдачей.

Системный контроллер предназначен для связи внутреннего интерфейса процессора
с внешним стандартным интерфейсом канала типа Q-шины (МПИ, OCT 11305.903-80).

Внутренний интерфейс процессора содержит сигналы, обеспечивающие работу
процессорного ядра. Это сигналы квитирования АЛУ и УП, 16-разрядная
информационная магистраль, четырехразрядная магистраль кода прерывания,
сигналы управления МПП. Сигналы квитирования <kbd>KB1</kbd>, <kbd>KB2</kbd>,
<kbd>КВ3</kbd>, <kbd>КП</kbd> обеспечивают передачу по 16-разрядной
двунаправленной магистрали адресов, данных и векторов прерывания в данный
момент обслуживания.

Внешний интерфейс процессора содержит сигналы, обеспечивающие работу всех
устройств, подключенных к каналу.

Вывод <kbd>КОШ</kbd> служит для подключения RС-цепочки, задающей длительность
сигналов <kbd>ДЧТ</kbd>, <kbd>ДЗП</kbd> до сигнала <kbd>OTB</kbd> и
длительность сигнала <kbd>СБРОС</kbd>.

Вход установки режима начального пуска <kbd>НП</kbd>, путем подачи на него
высокого потенциала, установлен в режим выхода на системное ПЗУ через
адрес-вектор 24.

Выходы <kbd>C1</kbd>, <kbd>C2</kbd> управляют направлением передачи данных
через магистральные приемопередатчики.

Системный контроллер D18 через входы <kbd>Р</kbd>, <kbd>Т</kbd> принимает
информацию о седьмом и четвертом разряде регистра слова состояния процессора
для обработки прерываний.

При нажатии на кнопку <kbd>ПУСК</kbd> на передней панели на выводах 8, 12
микросхемы D40 формируются сигналы начального пуска, которые устанавливают
микросхемы управляющей памяти и системного контроллера в начальное положение
и запускают микропрограмму начального пуска. Данная микропрограмма формирует
обращение процессорного ядра к ячейкам памяти с адресами 160006 и 160010,
откуда читает программный счетчик и слово состояния процессора
соответственно.

В адресном пространстве процессора адреса с 160000 по 167776 занимает
системное ПЗУ. Адресное пространство процессора 140000—157776
зарезервировано под дополнительные 4К слов системного ПЗУ.

При обращении к области памяти обязательного системного ПЗУ контроллер
запоминающего устройства D15 (КР588ВГ2) вырабатывает сигнал <kbd>ВК0</kbd>,
который разрешает выборку данных из ПЗУ D9, D10 (КР573РФ5). Адрес, по
которому ведется обращение, фиксируется в регистрах D7, D8 (КР588ИР1). Сигнал
<kbd>ОТВ</kbd> формирует микросхема D15 с задержкой относительно сигнала
<kbd>ОБМ</kbd>, определяемой времязадающей цепочкой R4, C4.

После установки счетчика команд и ССП процессор выходит на программу
«холодного» старта, записанной в системном ПЗУ.

После программы «холодного» старта процессор выходит на программу обработки
данных с клавиатуры.

Контроллер клавиатуры собран на микросхемах D26, D27 (КР588ИР1). Данные с
клавиатуры в последовательном коде через элемент D30.1 (К561ЛН2) поступают на
нулевой разряд канала <kbd>К0</kbd> D26. На вход <kbd>ЗП</kbd> D26 поступают
тактовые импульсы с частотой в 2 раза меньшей частоты импульсов, на основе
которых формируется информационная последовательность в блоке клавиатуры.
Выходы канала <kbd>K1</kbd> D26 соединены со входами канала <kbd>К0</kbd> D26
со смещением на один разряд, т.е. последовательный код с клавиатуры
преобразуется в параллельный.

По достижении стартовой посылки последнего разряда <kbd>K1</kbd> D26 триггер
D37.2 (К561ТМ2) формирует сигнал готовности контроллера клавиатуры к выдаче
данных. Этот сигнал поступает в HALT-монитор. Инверсным сигналом с триггера
D37.2 код символа переписывается в регистр D27. По окончании записи
вырабатывается сигнал <kbd>ЗЗП</kbd>, который сбрасывает входной регистр D26.

После обработки сигнала <kbd>Н2</kbd> (обращение к регистру данных
клавиатуры, сформированного в модуле ОЗУ), HALT-монитор выдает сигнал чтения
содержимого регистра D27 и код символа вводится в процессор.

Команды умножения (деления) выполняются БИС умножителя D17 (К588ВР2)
совместно с БИС селектора каналов D19 (КР588ВТ1) и БИС УП D4 (КР588ВУ2-0006).

После поступления команды умножения (деления) на шину ДА БИС УП (0006)
микросхема вырабатывает микрокоманды, под действием которых происходит
обработка двух операндов. Умножение начинается с засылки двух операндов в
регистры умножителя. При операциях чтения, записи данных умножитель формирует
сигнал <kbd>ГОТ</kbd>, отмечающий окончание операции. Чтение результата
производится с младших разрядов произведения. Последним читается регистр
состояния. Время умножения < 2 мкс отсчитывается с загрузки второго операнда
до чтения первого слова результата. При этом используются адреса 170000,
170002, 170004, которые дешифрируются селектором каналов D19.

HALT-монитор является процедурой, предназначенной для управления процессами,
«невидимыми» для основного программного обеспечения. К ним относятся:
эмуляция системной консоли (клавиатуры), операции пультового терминала,
работа с расширенной памятью.

Запросы на использование ресурсов HALT-монитора формируются двумя способами:
команда HALT или запрос по линии прерывания <kbd>ОСТ</kbd>. Для
диспетчеризации запросов предусмотрен регистр запросов с адресом 170007.
Младший байт этого регистра 170006 является регистром данных клавиатуры.
Запросы обрабатываются согласно их приоритету. По окончании обработки
содержимое регистра сбрасывается. Случаи возникновения прерываний по линии
<kbd>ОСТ</kbd> (согласно приоритету):

* появление канального сигнала <kbd>СБРОС</kbd>;
* запрос на обслуживание локальной сети;
* обращение к группе ячеек 177560—177566, соответствующих регистрам системной
  консоли;
* нажатие клавиши на клавиатуре.

Выполнение команды HALT‚ также как и ввод с клавиатуры кода 0 переводит
процессор в режим пультового терминала.

Использование для входа в HALT-монитор прерывания HALT объясняется тем, что
это единственное прерывание, адрес вектора которого лежит в адресном
пространстве системного ПЗУ. Для своих нужд HALT-монитор использует область
памяти 177600—177776, доступ к которой разрешается сигналом подтверждения
прерывания HALT. Этим достигается полная «прозрачность» процедур
HALT-монитора.

В схему аппаратной поддержки HALT-монитора входят:

* регистр приема запросов;
* регистр фиксации запросов;
* схема формирования сигнала прерывания <kbd>OCT</kbd>;
* регистр управления памятью.

Регистр приема запросов D32 (К561ТР2) осуществляет накопление запросов до
следующей обработки. При разрешении прерывания по линии <kbd>OCT</kbd> его
содержимое переписывается в регистр фиксации запросов D28 (КР588ИР1), откуда
может быть считано на шину данных. Сигналом «подтверждения прерывания»
<kbd>ОСТ</kbd> содержимое регистра сбрасывается. Обрабатывается запрос с
высшим приоритетом, после чего содержимое регистра фиксации очищается. Схема
формирования сигнала по линии <kbd>ОСТ</kbd> привязывает прерывание к сигналу
<kbd>КВ3</kbd> (вывод 11 D18, ввод команды), исключая этим вложенные
прерывания <kbd>ОСТ</kbd>.

## 6.2. Модуль ОЗУ

...

