# 6. Устройство и работа составных частей ПК

Конструктивно ПК состоит из следующих функционально законченных узлов и
блоков:

* модуль процессора 6.120.107;
* модуль ОЗУ 6.120.108;
* модуль локальной сети и таймер 6.120.109;
* модуль электронный 2MБ5 2.087.024;
* модуль электронный 2МБ12 2.087.024-01;
* блок клавиатуры 3.059.007;
* видеоконтрольное устройство (ВКУ).

## 6.1. Модуль процессора

Функционально модель процессора 6.120.107 ЭЗ состоит из следующих узлов:

* процессорное ядро;
* системное ПЗУ;
* контроллер клавиатуры;
* аппаратный умножитель;
* HALT-монитор.

Процессорное ядро включает в себя центральный процессорный элемент D1
(ЦПЭ КР588ВС2), выполняющий функции арифметико-логического устройства (АЛУ),
пять БИС управляющей памяти D2...D6 (КР588ВУ2), системный контроллер D18
(КР588ВГ1), два магистральных приемопередатчика (МПП) D21, D24 (КР588ВА1).

АЛУ предназначено для приема, хранения и обработки 16-разрядных чисел.
Преобразование данных выполняется в соответствии с 12-разрядным кодом
микрокоманды.

Последовательность фаз работы микросхемы определяет внутренний блок
синхронизации, функционирование которого начинается с поступлением
отрицательного фронта по входу сигнала сопровождения микрокоманды ВК (вывод
30).

Выполнение любой микрокоманды состоит из комбинации следующих фаз:

* приема: приема и дешифрации микрокоманды, а в некоторых микрокомандах и
  приема операнда по магистрали данных;
* чтения: чтения информации из источника (РОН, АКК, СК, К) в АЛУ и ее
  обработки;
* записи: окончание обработки информации и ее запись в приемник (РОН, АКК,
  СК, К;
* выдачи: выдача результата операции в МД.

Прием микрокоманд и обмен данными по магистрали производится асинхронно и
квитируется сигналами по выводам <kbd>ВК</kbd> и <kbd>Ф1</kbd>, <kbd>В</kbd>
и <kbd>П</kbd>, соответственно. Так как по шине микрокоманд информация может
только приниматься в АЛУ, выводы <kbd>ВК</kbd> и <kbd>Ф1</kbd> —
однонаправленные. Сигналы <kbd>В</kbd> и <kbd>П</kbd> — двунаправленные, т.к.
квитируют передачу данных по МД.

При приеме данных в МД сигнал на входе <kbd>В</kbd> генерируется системным
контроллером D18 и инициирует начало фазы ввода данных, сигнал на выходе
<kbd>П</kbd> служит квитанцией о приеме информации в АЛУ. При выдаче данных в
МД сигнал на выходе <kbd>В</kbd> (генерируется ЦПЭ) инициирует начало фазы
вывода данных, сигнал на входе <kbd>П</kbd> служит квитанцией для ЦПЭ о
приеме информации во внешние схемы. Ограничений на время ответа не
существует.

Управляющая память (УП) представляет собой программируемую логическую матрицу
(ПЛМ) с памятью. Она предназначена для управления работой процессорного ядра
и сочетает в себе функции БИС блока микропрограммного управления и ПЗУ
микрокоманд. Микросхемы с номерами кодировок 0001, 0002, 0004 предназначены
для управления АЛУ, БИС УП с кодировкой 0007 — для управления системным
контроллером D18, БИС с кодировкой 0006 предназначена для аппаратной
реализации команд расширенной арифметики (умножение, деление, сдвиги — MUL,
DIV, ASH, ASHC).

Сигналы на входах <kbd>R0</kbd> и <kbd>R1</kbd> по положительному фронту
устанавливают микросхему УП в исходное состояние. При наличии логического
нуля на выводе <kbd>В</kbd> происходит прием информации с магистрали данных
во входной регистр и по магистрали признаков кодов условий ветвления в
регистр признаков. Приняв информацию, микросхема устанавливает уровень
логического нуля на выводе <kbd>П</kbd> и активный низкий уровень на выводе
<kbd>КК</kbd>. При снятии сигнала «логический ноль» на выводе <kbd>В</kbd>
снимается сигнал и на выводе <kbd>П</kbd>.

По отрицательному фронту сигнала <kbd>Ф1</kbd> прекращается выдача
микрокоманды и происходит «подброс» в высокий потенциал состояния выводов
<kbd>МК(0-12)</kbd>. Если к этому времени сформирована следующая
микрокоманда, то происходит ее запись в регистры с последующей выдачей.

Системный контроллер предназначен для связи внутреннего интерфейса процессора
с внешним стандартным интерфейсом канала типа Q-шины (МПИ, OCT 11305.903-80).

Внутренний интерфейс процессора содержит сигналы, обеспечивающие работу
процессорного ядра. Это сигналы квитирования АЛУ и УП, 16-разрядная
информационная магистраль, четырехразрядная магистраль кода прерывания,
сигналы управления МПП. Сигналы квитирования <kbd>KB1</kbd>, <kbd>KB2</kbd>,
<kbd>КВ3</kbd>, <kbd>КП</kbd> обеспечивают передачу по 16-разрядной
двунаправленной магистрали адресов, данных и векторов прерывания в данный
момент обслуживания.

Внешний интерфейс процессора содержит сигналы, обеспечивающие работу всех
устройств, подключенных к каналу.

Вывод <kbd>КОШ</kbd> служит для подключения RС-цепочки, задающей длительность
сигналов <kbd>ДЧТ</kbd>, <kbd>ДЗП</kbd> до сигнала <kbd>OTB</kbd> и
длительность сигнала <kbd>СБРОС</kbd>.

Вход установки режима начального пуска <kbd>НП</kbd>, путем подачи на него
высокого потенциала, установлен в режим выхода на системное ПЗУ через
адрес-вектор 24.

Выходы <kbd>C1</kbd>, <kbd>C2</kbd> управляют направлением передачи данных
через магистральные приемопередатчики.

Системный контроллер D18 через входы <kbd>Р</kbd>, <kbd>Т</kbd> принимает
информацию о седьмом и четвертом разряде регистра слова состояния процессора
для обработки прерываний.

При нажатии на кнопку <kbd>ПУСК</kbd> на передней панели на выводах 8, 12
микросхемы D40 формируются сигналы начального пуска, которые устанавливают
микросхемы управляющей памяти и системного контроллера в начальное положение
и запускают микропрограмму начального пуска. Данная микропрограмма формирует
обращение процессорного ядра к ячейкам памяти с адресами 160006 и 160010,
откуда читает программный счетчик и слово состояния процессора
соответственно.

В адресном пространстве процессора адреса с 160000 по 167776 занимает
системное ПЗУ. Адресное пространство процессора 140000—157776
зарезервировано под дополнительные 4К слов системного ПЗУ.

При обращении к области памяти обязательного системного ПЗУ контроллер
запоминающего устройства D15 (КР588ВГ2) вырабатывает сигнал <kbd>ВК0</kbd>,
который разрешает выборку данных из ПЗУ D9, D10 (КР573РФ5). Адрес, по
которому ведется обращение, фиксируется в регистрах D7, D8 (КР588ИР1). Сигнал
<kbd>ОТВ</kbd> формирует микросхема D15 с задержкой относительно сигнала
<kbd>ОБМ</kbd>, определяемой времязадающей цепочкой R4, C4.

После установки счетчика команд и ССП процессор выходит на программу
«холодного» старта, записанной в системном ПЗУ.

После программы «холодного» старта процессор выходит на программу обработки
данных с клавиатуры.

Контроллер клавиатуры собран на микросхемах D26, D27 (КР588ИР1). Данные с
клавиатуры в последовательном коде через элемент D30.1 (К561ЛН2) поступают на
нулевой разряд канала <kbd>К0</kbd> D26. На вход <kbd>ЗП</kbd> D26 поступают
тактовые импульсы с частотой в 2 раза меньшей частоты импульсов, на основе
которых формируется информационная последовательность в блоке клавиатуры.
Выходы канала <kbd>K1</kbd> D26 соединены со входами канала <kbd>К0</kbd> D26
со смещением на один разряд, т.е. последовательный код с клавиатуры
преобразуется в параллельный.

По достижении стартовой посылки последнего разряда <kbd>K1</kbd> D26 триггер
D37.2 (К561ТМ2) формирует сигнал готовности контроллера клавиатуры к выдаче
данных. Этот сигнал поступает в HALT-монитор. Инверсным сигналом с триггера
D37.2 код символа переписывается в регистр D27. По окончании записи
вырабатывается сигнал <kbd>ЗЗП</kbd>, который сбрасывает входной регистр D26.

После обработки сигнала <kbd>Н2</kbd> (обращение к регистру данных
клавиатуры, сформированного в модуле ОЗУ), HALT-монитор выдает сигнал чтения
содержимого регистра D27 и код символа вводится в процессор.

Команды умножения (деления) выполняются БИС умножителя D17 (К588ВР2)
совместно с БИС селектора каналов D19 (КР588ВТ1) и БИС УП D4 (КР588ВУ2-0006).

После поступления команды умножения (деления) на шину ДА БИС УП (0006)
микросхема вырабатывает микрокоманды, под действием которых происходит
обработка двух операндов. Умножение начинается с засылки двух операндов в
регистры умножителя. При операциях чтения, записи данных умножитель формирует
сигнал <kbd>ГОТ</kbd>, отмечающий окончание операции. Чтение результата
производится с младших разрядов произведения. Последним читается регистр
состояния. Время умножения < 2 мкс отсчитывается с загрузки второго операнда
до чтения первого слова результата. При этом используются адреса 170000,
170002, 170004, которые дешифрируются селектором каналов D19.

HALT-монитор является процедурой, предназначенной для управления процессами,
«невидимыми» для основного программного обеспечения. К ним относятся:
эмуляция системной консоли (клавиатуры), операции пультового терминала,
работа с расширенной памятью.

Запросы на использование ресурсов HALT-монитора формируются двумя способами:
команда HALT или запрос по линии прерывания <kbd>ОСТ</kbd>. Для
диспетчеризации запросов предусмотрен регистр запросов с адресом 170007.
Младший байт этого регистра 170006 является регистром данных клавиатуры.
Запросы обрабатываются согласно их приоритету. По окончании обработки
содержимое регистра сбрасывается. Случаи возникновения прерываний по линии
<kbd>ОСТ</kbd> (согласно приоритету):

* появление канального сигнала <kbd>СБРОС</kbd>;
* запрос на обслуживание локальной сети;
* обращение к группе ячеек 177560—177566, соответствующих регистрам системной
  консоли;
* нажатие клавиши на клавиатуре.

Выполнение команды HALT‚ также как и ввод с клавиатуры кода 0 переводит
процессор в режим пультового терминала.

Использование для входа в HALT-монитор прерывания HALT объясняется тем, что
это единственное прерывание, адрес вектора которого лежит в адресном
пространстве системного ПЗУ. Для своих нужд HALT-монитор использует область
памяти 177600—177776, доступ к которой разрешается сигналом подтверждения
прерывания HALT. Этим достигается полная «прозрачность» процедур
HALT-монитора.

В схему аппаратной поддержки HALT-монитора входят:

* регистр приема запросов;
* регистр фиксации запросов;
* схема формирования сигнала прерывания <kbd>OCT</kbd>;
* регистр управления памятью.

Регистр приема запросов D32 (К561ТР2) осуществляет накопление запросов до
следующей обработки. При разрешении прерывания по линии <kbd>OCT</kbd> его
содержимое переписывается в регистр фиксации запросов D28 (КР588ИР1), откуда
может быть считано на шину данных. Сигналом «подтверждения прерывания»
<kbd>ОСТ</kbd> содержимое регистра сбрасывается. Обрабатывается запрос с
высшим приоритетом, после чего содержимое регистра фиксации очищается. Схема
формирования сигнала по линии <kbd>ОСТ</kbd> привязывает прерывание к сигналу
<kbd>КВ3</kbd> (вывод 11 D18, ввод команды), исключая этим вложенные
прерывания <kbd>ОСТ</kbd>.

## 6.2. Модуль ОЗУ

Функционально модуль ОЗУ 6.120.108 ЭЗ состоит из следующих узлов:

* адресный дешифратор;
* блок синхронизации;
* регистр прямой адресации;
* регистр косвенной адресации;
* адресный мультиплексор;
* накопитель;
* видеорегистр данных;
* канальный регистр данных;
* модулятор.

![fig-08](i/fig-08-small.png)

*Рис.8*

Адресный дешифратор собран на микросхемах D12, D13, D15. При обращении
процессора к области памяти, занимаемой ПЗУ (160000—170000), на выходе
мультиплексора D12 формируется высокий уровень, который фиксируется сигналом
<kbd>СИА</kbd> в регистре D13 и блокирует прохождение сигналов обращения к
памяти через элемент D4.1.

Для эмуляции стандартных устройств клавиатуры и терминала в массиве памяти
разрешен доступ по адресам 177560—177576. Сигналы выборки формируются
микросхемой D15:

* 177566 — обращение к регистру данных терминала (выход <kbd>D0</kbd>) — нa
  основе данного сигнала формируется запрос на прерывание <kbd>Н1</kbd>;
* 177564 — обращение к регистру состояния терминала (выход <kbd>D1</kbd>);
* 177562 — обращение к регистру данных клавиатуры (выход <kbd>D2</kbd>) — на
  основе данного сигнала формируется запрос на прерывание <kbd>Н2</kbd>;
* 177560 — обращение к регистру состояния клавиатуры (выход <kbd>D3</kbd>);
* 177572 — обращение к регистру адреса косвенной адресации (выход
  <kbd>Е2</kbd>);
* 177570 — обращение к регистру данных косвенной адресации (выход
  <kbd>E3</kbd>).

Блок синхронизации построен на базе кварцевого генератора, собранного на
микросхеме D1. Последовательность импульсов стабильной частоты 8 МГц делится
микросхемой D8 на последовательности со следующими частотами: 4 МГц, 2 МГц, 1
МГц.

Видеосчетчик, собранный на микросхемах D18...D21, делит входную
последовательность импульсов 1 МГц на последовательности, убывающими по
частоте кратными двум. Ha последнем разряде видеосчетчика (конт. 121)
формируется частота 50 Гц, запускающая формирователь кадровых
синхроимпульсов, собранный на одновибраторах D22.1, D22.2. Одновибратор D22.1
формирует импульсы нижнего бланка, определяющие расстояние от нижней кромки
рабочего растра до конца полного рабочего поля видеомонитора. Одновибратор
D22.2 формирует стандартный кадровый синхронизирующий импульс.

Строчный синхронизирующий импульс формируется элементом D23.1.

Элемент D23.2 вырабатывает импульс сброса видеосчетчика при подсчете 312
простейших линий в растре.

Формирование рабочего поля растра приведено на рис.9.

![fig-09](i/fig-09-small.png)

*Рис.9. Формирование рабочего растра синхроимпульсами*

1. Рабочее поле растра, формируемое контроллером видеотерминала
2. Рабочее поле растра, формируемое контроллером видеомонитора

Обмен данными с накопителем может производиться байтами и словами. Для этого
используются регистры косвенной и прямой адресации. При прямой адресации
адрес ячейки памяти записывается в регистр D26, D27 непосредственно из канала
по сигналу <kbd>СИА</kbd>.

При обращении к расширенной памяти (128 Кбайт) используется регистр косвенной
адресации (D28, D29). Запись в этот регистр осуществляется при обращении к
ячейке памяти с адресом 177572. При обрещении к ячейке с адресом 177570
происходит чтение или запись по адресу, хранящемуся в регистре косвенной
адресации D28, D29. Выходы регистра прямой адресации D27, D26 соединены
параллельно с выходами регистра косвенной адресации со сдвигом на один
разряд. Нулевой разряд регистра прямой адресации поступает на схему обработки
сигнала <kbd>К БАЙТ Н</kbd> (D9.4, D9.5, D30). При наличии сигнала <kbd>К
БАЙТ Н</kbd> на внешней шине управления при операции записи или чтения
нулевой разряд данного регистра участвует в выборе ячейки памяти и таким
образом организуется доступ к 128 Кбайтам накопителя. При обмене данными
размером в слово регистр косвенной адресации отключается и элемент D16.5
формирует логический ноль в разряде A17 регистра косвенной адресации.

В зависимости от вида адресации один из адресов поступает на входы адресного
мультиплексора, собранного на микросхемах D31...D34. Ha четырехвходовую ячейку
адресного мультиплексора поступают разряды от младшей и старшей части адреса,
а также младшей и старшей части видеоадреса, формируемого видеосчетчиком и
необходимого для регенерации динамической памяти. Под управлением сигналов
<kbd>S1</kbd> и <kbd>S0</kbd> адресный мультиплексор пропускает на адресные
входы накопителя старший или младший байт адреса ячейки, к которй
производится доступ, либо адреса регенерации динамической памяти.

Поступление старшего или младшего байта сопровождается квитированием сигналов
<kbd>RAS</kbd> и <kbd>CAS</kbd>. Сигналы <kbd>RAS</kbd> и <kbd>CAS</kbd>
формируются блоком синхронизации.

В то время, когда на входы накопителя подается адрес от видеосчетчика, т.е.
происходит процесс регенерации памяти, одновременно считывается информация из
области памяти, называемой видео ЗУ. Информация, записанная в видео ЗУ,
считывается в видеорегистр D53...D56, который разделен на старший и младший
байт. После защелкивания информации сигналом, она последовательно выводится
по сигналу <kbd>C</kbd> из старшего и младшего байтов и поступает на
модулятор.

Модулятор смешивает строчные и кадровые синхроимпульсы с информационным
сигналом и на эмиттере VT1 формируется полный видеосигнал. Наличие двух битов
информации o точке растра позволяет получить 4 градации яркости при выводе
изображения на экран монитора.

При каждом обращении процессора к памяти вырабатывается сигнал <kbd>СИП</kbd>
триггером D11.2‚ сигнализирующий о завершении приема.

Канальный регистр данных D51, D52 служит для фиксации данных, предназначенных
для вывода в канал.

Доступ к рабочему полю видеотерминала (32 Кбайта) осуществляется с помощью
косвенной адресации, начиная с адреса 140000. Оставшиеся 32 Кбайта
расширенной памяти отведены под электронный стек. Доступ к ним осуществляется
также с помощью косвенной адресации (адреса 100000—137777).

